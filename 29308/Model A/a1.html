<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Figure Eight Car Game</title>
    <style>
        body { 
            margin: 0; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            background: #f0f0f0; 
        }
        #gameCanvas {
            background: #333;
            border: 2px solid #000;
        }
        #score, #gameOver {
            position: absolute;
            color: white;
            font-family: Arial, sans-serif;
            font-size: 20px;
        }
        #score { top: 10px; left: 10px; }
        #gameOver { top: 50%; left: 50%; transform: translate(-50%, -50%); display: none; }
    </style>
</head>
<body>
<div id="score">Laps: 0</div>
<div id="gameOver">Game Over! Press 'R' to Restart</div>
<canvas id="gameCanvas" width="800" height="400"></canvas>
<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreDisplay = document.getElementById('score');
    const gameOverDisplay = document.getElementById('gameOver');

    // Game Variables
    let score = 0;
    let gameLoop;
    let player = {x: 100, y: 200, speed: 0, width: 20, height: 40};
    let enemies = [{x: 700, y: 200, speed: 2, width: 20, height: 40}];
    const acceleration = 0.1;
    const maxSpeed = 5;
    const friction = 0.05;

    // Key presses
    let keys = {};

    function update() {
        // Player movement
        if (keys['ArrowUp'] && player.speed < maxSpeed) player.speed += acceleration;
        if (keys['ArrowDown']) player.speed = Math.max(player.speed - acceleration, 0);
        player.speed *= (1 - friction); // Apply friction
        player.y += player.speed;

        // Enemy movement
        enemies.forEach(enemy => {
            enemy.y += enemy.speed;
            if (enemy.y > canvas.height) {
                enemy.y = -enemy.height; // Reset position
                enemy.x = Math.random() * (canvas.width - enemy.width); // Random X for difficulty
            }
        });

        // Collision detection
        if (checkCollision(player, enemies)) {
            gameOver();
            return;
        }

        // Score update for lap completion (simplified for figure eight)
        if (player.y > canvas.height) {
            player.y = 0;
            score++;
            scoreDisplay.textContent = 'Laps: ' + score;
            // Increase difficulty here if needed
        }

        render();
    }

    function checkCollision(obj1, list) {
        return list.some(obj2 => 
            obj1.x < obj2.x + obj2.width && 
            obj1.x + obj1.width > obj2.x &&
            obj1.y < obj2.y + obj2.height &&
            obj1.y + obj1.height > obj2.y
        );
    }

    function render() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        // Draw track (simplified)
        ctx.strokeStyle = 'grey';
        ctx.lineWidth = 20;
        ctx.beginPath();
        ctx.moveTo(0, canvas.height / 2);
        ctx.lineTo(canvas.width, canvas.height / 2);
        ctx.stroke();
        // Draw player and enemies
        ctx.fillStyle = 'blue';
        ctx.fillRect(player.x, player.y, player.width, player.height);
        ctx.fillStyle = 'red';
        enemies.forEach(enemy => ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height));
    }

    function gameOver() {
        clearInterval(gameLoop);
        gameOverDisplay.style.display = 'block';
    }

    function startGame() {
        score = 0;
        player.speed = 0;
        player.y = 200;
        enemies = [{x: 700, y: 200, speed: 2, width: 20, height: 40}];
        gameOverDisplay.style.display = 'none';
        scoreDisplay.textContent = 'Laps: 0';
        gameLoop = setInterval(update, 1000/60);
    }

    document.addEventListener('keydown', function(e) {
        keys[e.key] = true;
        if(e.key === 'r' || e.key === 'R') startGame();
    });
    document.addEventListener('keyup', function(e) {
        keys[e.key] = false;
    });

    startGame();
</script>
</body>
</html>